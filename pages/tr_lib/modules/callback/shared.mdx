# Shared

# Callback
A callback is a function that is passed as an argument to another function and is executed after some operation has been completed. Callbacks are commonly used in asynchronous programming to handle events or the completion of tasks.

## lib.callback.register
Register a callback that can be called from the client or server side.

```lua
exports.tr_lib:callback().register(name, func)
```

### Parameters
* `name` (string): The name of the callback to be registered.
* `func` (function): The function to be executed when the callback is called.

### Notes
* Server-side callbacks automatically receive `source` (player ID) as the first parameter when called from a client
* Client-side callbacks automatically receive `senderId` (caller's player ID) as the first parameter

### Example

```lua filename="wrapper/callback.lua"
lib = exports.tr_lib
```

```lua filename="server/main.lua"
lib:callback().register('getData', function(source, playerId)
    return {id = playerId, name = 'John'}
end)
```

```lua filename="client/main.lua"
lib:callback().register('getHealth', function(senderId)
    return GetEntityHealth(PlayerPedId())
end)
```

## lib.callback.awaitServer
Call a callback registered on the server and wait for its result from the client or server side.

```lua
exports.tr_lib:callback().awaitServer(name, timeout, ...)
```

### Parameters
* `name` (string): The name of the callback to be executed on the server.
* `timeout` (number, optional): The maximum time to wait in milliseconds. Default is 5000.
* `...` (any): Additional arguments to be passed to the server callback function.

### Example

```lua filename="client/main.lua"
local result = lib:callback().register('buyItem', 5000, 'bread', 2)
if result and result.success then
    print('Purchase successful!')
end
```

```lua filename="server/main.lua"
local tax = lib:callback().register('calculateTax', 5000, 1000)
print('Tax:', tax)
```

## lib.callback.awaitClient
Call a callback registered on the client and wait for its result from the server or client side.

```lua
exports.tr_lib:callback().awaitClient(name, playerId, timeout, ...)
```

### Parameters
* `name` (string): The name of the callback to be executed on the client.
* `playerId` (number): The server ID of the target player/client.
* `timeout` (number, optional): The maximum time to wait in milliseconds. Default is 5000.
* `...` (any): Additional arguments to be passed to the client callback function.

### Example

```lua filename="server/main.lua"
RegisterNetEvent('someEvent', function()
    local info = lib:callback().register('getPlayerInfo', source, 5000)
    if info then
        print('Health:', info.health)
    end
end)
```

```lua filename="client/main.lua"
local targetPlayerId = GetPlayerServerId(GetPlayerFromIndex(0))
local response = lib:callback().register('tradeRequest', targetPlayerId, 5000, 'Diamond')
if response and response.accepted then
    print('Trade accepted!')
end
```

## Notes

* Client-to-client communication goes through the server as a relay
* Multiple return values are supported
* Always check for `nil` results as they indicate timeout or errors
* Recommended timeout values: 3000-5000ms